<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Delinquency</title>

    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"></style>
  <script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

  </head>


  <body>
    <h1>Delinquincy List</h1>
    <table id="myTable" class="table table-hover">
<thead class="thead-dark">
  <tr>
    <th scope="col">Payor</th>
    <th scope="col">Due Date</th>
    <th scope="col">Surcharge</th>
    <th scope="col">Action</th>
    <th scope="col">Transaction</th>
  </tr>
</thead>
<tbody>
  {%for row in rows%}
  <tr>
  <td>{{row.name}}</td>
  <td>{{row.date}}</td>
  <td>{{row.penalty}}</td>
  <td><button type="button" class="btn btn-primary mybutton" data-toggle="modal" data-target="#exampleModal" id="editRow" data-row-val="{{row.name}}" >Edit</button>

  <form action="/delinquincy/delete" method="POST">
    <input type="hidden" name="delete_row" value="{{row.name}}">
    <button type="submit" class="btn btn-danger" name="delete">Delete</button>
  </form>
</td>
  <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#payModal" id="pay" >Pay</td>

  </tr>
  {% endfor %}

</tbody>
</table>
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <form class="form-horizontal" action="/delinquincy/edit" method="POST" role="form">
      <input type="text" name="entity_key" class="hidden">
    <div class="modal-body edit-body">
    <div class="form-group">
    <label for="payor" class="col-sm-2 control-label">Name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" id="payor" name="payor" value="">
    </div>
  </div>
  <div class="form-group">
    <label for="penalty" class="col-sm-2 control-label">Date</label>
    <div class="col-sm-10">
      <input type="date" class="form-control" id="date" name="date">
    </div>
  </div>

  <div class="form-group">
    <label for="penalty" class="col-sm-2 control-label">Penalty</label>
    <div class="col-sm-10">
      <input type="number" class="form-control" id="penalty" name="penalty" placeholder="Amount">
    </div>
  </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      <button type="submit" class="btn btn-primary">Save changes</button>
      </form>
    </div>
  </div>
</div>
</div>

<!-- Pay MOdall -->
<div class="modal" id="payModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="row">
          <div class="col-xs-3">
            <div class="form-group">
                <select class="selectpicker form-control" id="myselect">
                {% for get in gets%}
                <option value="{{get[0]}}">{{get[0]}}</option>
                {%endfor%}
              </select>
              <button type="submit" name="button" id="trigger">Select</button>
            </div>
              <table class="table table-bordered" id="subtable">
              <thead>
                  <tr>
                    <th scope="col">Quarter</th>
                    <th scope="col">O.R.number</th>
                    <th scope="col">Action</th>
                  </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1st Quarter</td>
                    <td id="q1"> </td>
                    <td><button type="button" class="btn btn-primary subbutton" data-toggle="modal" data-target="#submodal" id="pay" data-row-val="" >Pay</button></td>
                </tr>

                <tr>
                  <td>2nd Quarter</td>
                    <td id="q2"> </td>
                    <td><button type="button" class="btn btn-primary subbutton" data-toggle="modal" data-target="#submodal" id="pay" data-row-val="" >Pay</button></td>
                </tr>

                <tr>
                  <td>3rd Quarter</td>
                    <td id="q3"> </td>
                    <td><button type="button" class="btn btn-primary subbutton" data-toggle="modal" data-target="#submodal" id="pay" data-row-val="" >Pay</button></td>
                </tr>

                <tr>
                  <td>4th Quarter</td>
                    <td id="q4"> </td>
                    <td><button type="button" class="btn btn-primary subbutton" data-toggle="modal" data-target="#submodal" id="pay" data-row-val="" >Pay</button></td>
                </tr>

              </tbody>
            </table>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
</div>
</div>




<div class="modal fade bd-example-modal-sm" id="submodal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
        Amount: <input type="text" name="postAmount" value="">

      <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-sm">Pocess</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



      <script type="text/javascript">
          function ConfirmDelete(o){
            var x = confirm("Are you sure you want to delete?");
            var p=o.parentNode.parentNode;
            if (x)
              p.parentNode.removeChild(p)
            else
            return false;
          }
      </script>

      <script>
        $(document).ready(function(){

          $('#myTable').dataTable();

          $('.mybutton').click(function(){
              $("#exampleModal .modal-title").html("<h3>Edit data</h3>");
              $("#exampleModal button[type=submit]").html("Save changes");
              var my_row_value = $(this).attr('data-row-val');
              $(".edit-body #payor").val(my_row_value );

          })
          $('#trigger').click(function(){
            var send = $('#myselect').val();
            $.ajax({

                data:{
                  sent: send
                },
                type: 'POST',
                url: '/delinquincy'
            })
            .done(function(data){
        
              data=JSON.parse(data)
              $('#q1').html(data[1])
              $('#q2').html(data[2])
              $('#q3').html(data[3])
              $('#q4').html(data[4])
            })
          })
        })


      </script>
  </body>
</html>
